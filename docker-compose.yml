services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      target: production
    ports:
      - "${PORT:-3000}:80"
    depends_on:
      - backend
    restart: unless-stopped

  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
      target: production
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/data/hosting.db
      - JWT_SECRET=${JWT_SECRET:?Set JWT_SECRET in .env file}
      - SMTP_HOST=${SMTP_HOST:-localhost}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_FROM=${SMTP_FROM:-noreply@example.com}
      - FRONTEND_URL=${FRONTEND_URL:-}
      - CORS_ORIGINS=${CORS_ORIGINS:-}
    volumes:
      - data:/app/data
    expose:
      - "8080"
    restart: unless-stopped

volumes:
  data:
